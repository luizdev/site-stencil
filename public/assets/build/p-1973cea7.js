/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(i,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])})(i,n)};function i(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function s(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}var n=function(){return(n=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t}).apply(this,arguments)},s=function t(){!function(t,i){for(var n in i.prototype)t.prototype[n]=i.prototype[n]}(t,google.maps.OverlayView)};function h(t){return Object.keys(t).reduce((function(i,n){return t[n]&&i.push(n+":"+t[n]),i}),[]).join(";")}function o(t){return t?t+"px":void 0}var e=function(t){function s(i,n){var s=t.call(this)||this;return s.cluster_=i,s.styles_=n,s.center_=null,s.div_=null,s.sums_=null,s.visible_=!1,s.style=null,s.setMap(i.getMap()),s}return i(s,t),s.prototype.onAdd=function(){var t,i,n=this,s=this.cluster_.getMarkerClusterer(),h=google.maps.version.split("."),o=h[1],e=100*parseInt(h[0],10)+parseInt(o,10);this.div_=document.createElement("div"),this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",(function(){i=t})),google.maps.event.addDomListener(this.div_,"mousedown",(function(){t=!0,i=!1})),google.maps.event.addDomListener(this.div_,"contextmenu",(function(){google.maps.event.trigger(s,"contextmenu",n.cluster_)})),e>=332&&google.maps.event.addDomListener(this.div_,"touchstart",(function(t){t.stopPropagation()})),google.maps.event.addDomListener(this.div_,"click",(function(h){if(t=!1,!i){if(google.maps.event.trigger(s,"click",n.cluster_),google.maps.event.trigger(s,"clusterclick",n.cluster_),s.getZoomOnClick()){var o=s.getMaxZoom(),e=n.cluster_.getBounds();s.getMap().fitBounds(e),setTimeout((function(){s.getMap().fitBounds(e),null!==o&&s.getMap().getZoom()>o&&s.getMap().setZoom(o+1)}),100)}h.cancelBubble=!0,h.stopPropagation&&h.stopPropagation()}})),google.maps.event.addDomListener(this.div_,"mouseover",(function(){google.maps.event.trigger(s,"mouseover",n.cluster_)})),google.maps.event.addDomListener(this.div_,"mouseout",(function(){google.maps.event.trigger(s,"mouseout",n.cluster_)}))},s.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)},s.prototype.draw=function(){if(this.visible_){var t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px"}},s.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},s.prototype.show=function(){this.div_&&(this.div_.className=this.className_,this.div_.style.cssText=this.createCss_(this.getPosFromLatLng_(this.center_)),this.div_.innerHTML=(this.style.url?this.getImageElementHtml():"")+this.getLabelDivHtml(),this.div_.title=void 0===this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""),this.visible_=!0},s.prototype.getLabelDivHtml=function(){return'\n<div aria-label="'+this.cluster_.getMarkerClusterer().ariaLabelFn(this.sums_.text)+'" style="'+h({position:"absolute",top:o(this.anchorText_[0]),left:o(this.anchorText_[1]),color:this.style.textColor,"font-size":o(this.style.textSize),"font-family":this.style.fontFamily,"font-weight":this.style.fontWeight,"font-style":this.style.fontStyle,"text-decoration":this.style.textDecoration,"text-align":"center",width:o(this.style.width),"line-height":o(this.style.textLineHeight)})+'" tabindex="0">\n  <span aria-hidden="true">'+this.sums_.text+"</span>\n</div>\n"},s.prototype.getImageElementHtml=function(){var t=(this.style.backgroundPosition||"0 0").split(" "),i=parseInt(t[0].replace(/^\s+|\s+$/g,""),10),s=parseInt(t[1].replace(/^\s+|\s+$/g,""),10),e={};if(this.cluster_.getMarkerClusterer().getEnableRetinaIcons())e={width:o(this.style.width),height:o(this.style.height)};else{var r=[-1*s,-1*i+this.style.width,-1*s+this.style.height,-1*i];e={clip:"rect("+r[0]+"px, "+r[1]+"px, "+r[2]+"px, "+r[3]+"px)"}}var u=this.sums_.url?{width:"100%",height:"100%"}:{},f=h(n(n({position:"absolute",top:o(s),left:o(i)},e),u));return'<img alt="'+this.sums_.text+'" aria-hidden="true" src="'+this.style.url+'" style="'+f+'"/>'},s.prototype.useStyle=function(t){this.sums_=t;var i=Math.max(0,t.index-1);i=Math.min(this.styles_.length-1,i),this.style=this.sums_.url?n(n({},this.styles_[i]),{url:this.sums_.url}):this.styles_[i],this.anchorText_=this.style.anchorText||[0,0],this.anchorIcon_=this.style.anchorIcon||[Math.floor(this.style.height/2),Math.floor(this.style.width/2)],this.className_=this.cluster_.getMarkerClusterer().getClusterClass()+" "+(this.style.className||"cluster-"+i)},s.prototype.setCenter=function(t){this.center_=t},s.prototype.createCss_=function(t){return h({"z-index":""+this.cluster_.getMarkerClusterer().getZIndex(),top:o(t.y),left:o(t.x),width:o(this.style.width),height:o(this.style.height),cursor:"pointer",position:"absolute","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"})},s.prototype.getPosFromLatLng_=function(t){var i=this.getProjection().fromLatLngToDivPixel(t);return i.x=Math.floor(i.x-this.anchorIcon_[1]),i.y=Math.floor(i.y-this.anchorIcon_[0]),i},s}(s),r=function(){function t(t){this.markerClusterer_=t,this.map_=this.markerClusterer_.getMap(),this.minClusterSize_=this.markerClusterer_.getMinimumClusterSize(),this.averageCenter_=this.markerClusterer_.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new e(this,this.markerClusterer_.getStyles())}return t.prototype.getSize=function(){return this.markers_.length},t.prototype.getMarkers=function(){return this.markers_},t.prototype.getCenter=function(){return this.center_},t.prototype.getMap=function(){return this.map_},t.prototype.getMarkerClusterer=function(){return this.markerClusterer_},t.prototype.getBounds=function(){for(var t=new google.maps.LatLngBounds(this.center_,this.center_),i=this.getMarkers(),n=0;n<i.length;n++)t.extend(i[n].getPosition());return t},t.prototype.remove=function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_},t.prototype.addMarker=function(t){if(this.isMarkerAlreadyAdded_(t))return!1;if(this.center_){if(this.averageCenter_){var i=this.markers_.length+1,n=(this.center_.lat()*(i-1)+t.getPosition().lat())/i,s=(this.center_.lng()*(i-1)+t.getPosition().lng())/i;this.center_=new google.maps.LatLng(n,s),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();t.isAdded=!0,this.markers_.push(t);var h=this.markers_.length,o=this.markerClusterer_.getMaxZoom();if(null!==o&&this.map_.getZoom()>o)t.getMap()!==this.map_&&t.setMap(this.map_);else if(h<this.minClusterSize_)t.getMap()!==this.map_&&t.setMap(this.map_);else if(h===this.minClusterSize_)for(var e=0;e<h;e++)this.markers_[e].setMap(null);else t.setMap(null);return!0},t.prototype.isMarkerInClusterBounds=function(t){return this.bounds_.contains(t.getPosition())},t.prototype.calculateBounds_=function(){var t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)},t.prototype.updateIcon=function(){var t=this.markers_.length,i=this.markerClusterer_.getMaxZoom();if(null!==i&&this.map_.getZoom()>i)this.clusterIcon_.hide();else if(t<this.minClusterSize_)this.clusterIcon_.hide();else{var n=this.markerClusterer_.getStyles().length,s=this.markerClusterer_.getCalculator()(this.markers_,n);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(s),this.clusterIcon_.show()}},t.prototype.isMarkerAlreadyAdded_=function(t){if(this.markers_.indexOf)return-1!==this.markers_.indexOf(t);for(var i=0;i<this.markers_.length;i++)if(t===this.markers_[i])return!0;return!1},t}(),u=function(t,i,n){return void 0!==t[i]?t[i]:n},f=function(t){function s(i,n,h){void 0===n&&(n=[]),void 0===h&&(h={});var o=t.call(this)||this;return o.options=h,o.markers_=[],o.clusters_=[],o.listeners_=[],o.activeMap_=null,o.ready_=!1,o.ariaLabelFn=o.options.ariaLabelFn||function(){return""},o.zIndex_=o.options.zIndex||Number(google.maps.Marker.MAX_ZINDEX)+1,o.gridSize_=o.options.gridSize||60,o.minClusterSize_=o.options.minimumClusterSize||2,o.maxZoom_=o.options.maxZoom||null,o.styles_=o.options.styles||[],o.title_=o.options.title||"",o.zoomOnClick_=u(o.options,"zoomOnClick",!0),o.averageCenter_=u(o.options,"averageCenter",!1),o.ignoreHidden_=u(o.options,"ignoreHidden",!1),o.enableRetinaIcons_=u(o.options,"enableRetinaIcons",!1),o.imagePath_=o.options.imagePath||s.IMAGE_PATH,o.imageExtension_=o.options.imageExtension||s.IMAGE_EXTENSION,o.imageSizes_=o.options.imageSizes||s.IMAGE_SIZES,o.calculator_=o.options.calculator||s.CALCULATOR,o.batchSize_=o.options.batchSize||s.BATCH_SIZE,o.batchSizeIE_=o.options.batchSizeIE||s.BATCH_SIZE_IE,o.clusterClass_=o.options.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(o.batchSize_=o.batchSizeIE_),o.setupStyles_(),o.addMarkers(n,!0),o.setMap(i),o}return i(s,t),s.prototype.onAdd=function(){var t=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.prevZoom_=this.getMap().getZoom(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",(function(){var i=t.getMap(),n=i.minZoom||0,s=Math.min(i.maxZoom||100,i.mapTypes[i.getMapTypeId()].maxZoom),h=Math.min(Math.max(t.getMap().getZoom(),n),s);t.prevZoom_!=h&&(t.prevZoom_=h,t.resetViewport_(!1))})),google.maps.event.addListener(this.getMap(),"idle",(function(){t.redraw_()}))]},s.prototype.onRemove=function(){for(var t=0;t<this.markers_.length;t++)this.markers_[t].getMap()!==this.activeMap_&&this.markers_[t].setMap(this.activeMap_);for(t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();for(this.clusters_=[],t=0;t<this.listeners_.length;t++)google.maps.event.removeListener(this.listeners_[t]);this.listeners_=[],this.activeMap_=null,this.ready_=!1},s.prototype.draw=function(){},s.prototype.setupStyles_=function(){if(!(this.styles_.length>0))for(var t=0;t<this.imageSizes_.length;t++){var i=this.imageSizes_[t];this.styles_.push(s.withDefaultStyle({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:i,width:i}))}},s.prototype.fitMapToMarkers=function(t){for(var i=this.getMarkers(),n=new google.maps.LatLngBounds,s=0;s<i.length;s++)!i[s].getVisible()&&this.getIgnoreHidden()||n.extend(i[s].getPosition());this.getMap().fitBounds(n,t)},s.prototype.getGridSize=function(){return this.gridSize_},s.prototype.setGridSize=function(t){this.gridSize_=t},s.prototype.getMinimumClusterSize=function(){return this.minClusterSize_},s.prototype.setMinimumClusterSize=function(t){this.minClusterSize_=t},s.prototype.getMaxZoom=function(){return this.maxZoom_},s.prototype.setMaxZoom=function(t){this.maxZoom_=t},s.prototype.getZIndex=function(){return this.zIndex_},s.prototype.setZIndex=function(t){this.zIndex_=t},s.prototype.getStyles=function(){return this.styles_},s.prototype.setStyles=function(t){this.styles_=t},s.prototype.getTitle=function(){return this.title_},s.prototype.setTitle=function(t){this.title_=t},s.prototype.getZoomOnClick=function(){return this.zoomOnClick_},s.prototype.setZoomOnClick=function(t){this.zoomOnClick_=t},s.prototype.getAverageCenter=function(){return this.averageCenter_},s.prototype.setAverageCenter=function(t){this.averageCenter_=t},s.prototype.getIgnoreHidden=function(){return this.ignoreHidden_},s.prototype.setIgnoreHidden=function(t){this.ignoreHidden_=t},s.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons_},s.prototype.setEnableRetinaIcons=function(t){this.enableRetinaIcons_=t},s.prototype.getImageExtension=function(){return this.imageExtension_},s.prototype.setImageExtension=function(t){this.imageExtension_=t},s.prototype.getImagePath=function(){return this.imagePath_},s.prototype.setImagePath=function(t){this.imagePath_=t},s.prototype.getImageSizes=function(){return this.imageSizes_},s.prototype.setImageSizes=function(t){this.imageSizes_=t},s.prototype.getCalculator=function(){return this.calculator_},s.prototype.setCalculator=function(t){this.calculator_=t},s.prototype.getBatchSizeIE=function(){return this.batchSizeIE_},s.prototype.setBatchSizeIE=function(t){this.batchSizeIE_=t},s.prototype.getClusterClass=function(){return this.clusterClass_},s.prototype.setClusterClass=function(t){this.clusterClass_=t},s.prototype.getMarkers=function(){return this.markers_},s.prototype.getTotalMarkers=function(){return this.markers_.length},s.prototype.getClusters=function(){return this.clusters_},s.prototype.getTotalClusters=function(){return this.clusters_.length},s.prototype.addMarker=function(t,i){this.pushMarkerTo_(t),i||this.redraw_()},s.prototype.addMarkers=function(t,i){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.pushMarkerTo_(t[n]);i||this.redraw_()},s.prototype.pushMarkerTo_=function(t){var i=this;t.getDraggable()&&google.maps.event.addListener(t,"dragend",(function(){i.ready_&&(t.isAdded=!1,i.repaint())})),t.isAdded=!1,this.markers_.push(t)},s.prototype.removeMarker=function(t,i){var n=this.removeMarker_(t);return!i&&n&&this.repaint(),n},s.prototype.removeMarkers=function(t,i){for(var n=!1,s=0;s<t.length;s++){var h=this.removeMarker_(t[s]);n=n||h}return!i&&n&&this.repaint(),n},s.prototype.removeMarker_=function(t){var i=-1;if(this.markers_.indexOf)i=this.markers_.indexOf(t);else for(var n=0;n<this.markers_.length;n++)if(t===this.markers_[n]){i=n;break}return-1!==i&&(t.setMap(null),this.markers_.splice(i,1),!0)},s.prototype.clearMarkers=function(){this.resetViewport_(!0),this.markers_=[]},s.prototype.repaint=function(){var t=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout((function(){for(var i=0;i<t.length;i++)t[i].remove()}),0)},s.prototype.getExtendedBounds=function(t){var i=this.getProjection(),n=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),s=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),h=i.fromLatLngToDivPixel(n);h.x+=this.gridSize_,h.y-=this.gridSize_;var o=i.fromLatLngToDivPixel(s);o.x-=this.gridSize_,o.y+=this.gridSize_;var e=i.fromDivPixelToLatLng(h),r=i.fromDivPixelToLatLng(o);return t.extend(e),t.extend(r),t},s.prototype.redraw_=function(){this.createClusters_(0)},s.prototype.resetViewport_=function(t){for(var i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();for(this.clusters_=[],i=0;i<this.markers_.length;i++){var n=this.markers_[i];n.isAdded=!1,t&&n.setMap(null)}},s.prototype.distanceBetweenPoints_=function(t,i){var n=(i.lat()-t.lat())*Math.PI/180,s=(i.lng()-t.lng())*Math.PI/180,h=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(i.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371},s.prototype.isMarkerInBounds_=function(t,i){return i.contains(t.getPosition())},s.prototype.addToClosestCluster_=function(t){for(var i=4e4,n=null,s=0;s<this.clusters_.length;s++){var h,o=(h=this.clusters_[s]).getCenter();if(o){var e=this.distanceBetweenPoints_(o,t.getPosition());e<i&&(i=e,n=h)}}n&&n.isMarkerInClusterBounds(t)?n.addMarker(t):((h=new r(this)).addMarker(t),this.clusters_.push(h))},s.prototype.createClusters_=function(t){var i=this;if(this.ready_){0===t&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var n=new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()),s=this.getExtendedBounds(n),h=Math.min(t+this.batchSize_,this.markers_.length),o=t;o<h;o++){var e=this.markers_[o];!e.isAdded&&this.isMarkerInBounds_(e,s)&&(!this.ignoreHidden_||this.ignoreHidden_&&e.getVisible())&&this.addToClosestCluster_(e)}if(h<this.markers_.length)this.timerRefStatic=window.setTimeout((function(){i.createClusters_(h)}),0);else for(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this),o=0;o<this.clusters_.length;o++)this.clusters_[o].updateIcon()}},s.CALCULATOR=function(t,i){for(var n=0,s=t.length,h=s;0!==h;)h=Math.floor(h/10),n++;return n=Math.min(n,i),{text:s.toString(),index:n,title:""}},s.withDefaultStyle=function(t){return n({textColor:"black",textSize:11,textDecoration:"none",textLineHeight:t.height,fontWeight:"bold",fontStyle:"normal",fontFamily:"Arial,sans-serif",backgroundPosition:"0 0"},t)},s.BATCH_SIZE=2e3,s.BATCH_SIZE_IE=500,s.IMAGE_PATH="../images/m",s.IMAGE_EXTENSION="png",s.IMAGE_SIZES=[53,56,66,78,90],s}(s);export{f as M}