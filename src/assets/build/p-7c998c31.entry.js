import{r as t,c as e,h as s,g as a}from"./p-44118c4f.js";import"./p-acc16ed7.js";import{b as i,g as o}from"./p-54bbcf8c.js";import{M as n}from"./p-1973cea7.js";const c=class{constructor(s){t(this,s),this.searchCompleted=e(this,"searchCompleted",7),this.dragEnd=e(this,"dragEnd",7),this.itemSelected=e(this,"itemSelected",7),this.position={lat:40.440483799999996,lng:-3.7870695},this.locations=[],this.distance=2,this.mapIsReady=!1,this.visible=!1,this.newSearch=!1,this.$=window.$,this.markers=[],this.url_assets=`${i()}${o()}/assets/icon/`,this.url_marca=`${i()}${o()}/assets/img/marcas`}validateLocations(t,e){t!==e&&(this.newSearch=!0)}render(){return s("div",{class:"mm-search-locations-container"},s("div",{class:"table-container"},this.renderSearchInput(),this.renderTable(),this.renderInfo()),s("div",{class:"map-container"},s("div",{id:"map"})))}componentWillLoad(){if(this.channel)if("object"==typeof google&&"object"==typeof google.maps)this.mapIsReady=!0;else{const t=document.createElement("script");t.src=`https://maps.googleapis.com/maps/api/js?client=gme-mutuamadrilenaautomovilista&v=3&channel=${this.channel}&libraries=places,geometry`,t.async=!0,t.defer=!0,t.addEventListener("load",(()=>{this.mapIsReady=!0})),document.body.appendChild(t)}else console.log("mm-search-locations -> El parametro channel es obligatorio")}componentDidLoad(){this.table=this.searchLocationsElement.querySelector("mm-listing"),this.searchOnEnter(),this.hideComponents()}componentDidUpdate(){this.mapIsReady&&this.initMap(),this.newSearch&&(this.addMarkers(),this.createClusters(),this.table&&this.$.fn.DataTable&&(this.dataTable=this.$("mm-search-locations table").DataTable(),this.fillTableBody()),this.newSearch=!1),this.infoSelected&&this.locations.length&&this.showInfoSelected()}renderSearchInput(){return s("div",{class:"search-container"},s("mm-textfield",{label:"Dirección (completa o aproximada)"},s("input",{id:"search-input",type:"text",placeholder:"Introduce dirección, código postal, ciudad…"})),s("input",{id:"searchButton",type:"button",class:"mm-button basic main",onClick:()=>this.searchPosition(),value:"Buscar"}))}renderTable(){return s("mm-listing",{"items-page":"5","check-column":!0,"single-selection":!0,"map-style":!0,class:"mapStyle"},s("table",{slot:"table"},s("thead",null,s("tr",null,s("th",{"data-sortable":!0,class:"name"},"Taller"),s("th",{"data-type":"num","data-sortable":!0,"data-default-order":"asc",class:"distance"},"Distancia"),s("th",{"data-sortable":!0,class:"concertado"},"Concertado"))),s("tbody",null)),s("slot",null))}renderInfo(){return s("div",{class:"info-container"},"Selecciona una ubicación para ver más detalles")}fillTableBody(){this.dataTable.clear(),this.locations.map((t=>{const e=new google.maps.LatLng(this.position.lat,this.position.lng),s=new google.maps.LatLng(t.coordenadaX,t.coordenadaY),a=google.maps.geometry.spherical.computeDistanceBetween(s,e)/1e3;this.dataTable.row.add(["",t.razonComercial,a.toFixed(2),t.tipoConciertoTaller>0?"SI":"NO"])})),this.dataTable.draw(),this.dataTable.off("select").on("select",((t,e,s,a)=>{google.maps.event.trigger(this.markers[a[0]],"click")})),this.dataTable.off("deselect").on("deselect",((t,e,s,a)=>{google.maps.event.trigger(this.markers[a[0]],"click")}))}removeTablePrevItem(){const t=this.dataTable.rows(".map-item-selected");t[0].length&&t.nodes().to$().removeClass("selected").removeClass("map-item-selected")}initMap(){this.mapIsReady=!1,this.map=new google.maps.Map(this.searchLocationsElement.querySelector("#map"),{zoom:16,styles:[{featureType:"administrative",elementType:"labels",stylers:[{color:"#2a9dde"}]},{featureType:"administrative",elementType:"labels.text",stylers:[{color:"#2a9dde"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#d4ecf6"}]}]});const t=this.searchLocationsElement.querySelector("#search-input");this.autocomplete=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"ES"}}),this.autocomplete.bindTo("bounds",this.map),this.autocomplete.setFields(["geometry"]),this.autocomplete.addListener("place_changed",(()=>{this.autocomplete.getPlace()&&(this.searchLocationsElement.querySelector("#searchButton").disabled=!1)})),this.infoWindow=new google.maps.InfoWindow,google.maps.event.addListener(this.map,"dragend",(()=>{this.dragEnd.emit(),this.calculateCoordinates(this.map.getCenter())}))}searchOnEnter(){const t=this.searchLocationsElement.querySelector("#search-input");this.$(t).keydown((t=>{if(13==t.keyCode)return this.searchPosition(),!1}))}searchPosition(){const t=document.getElementById("search-input");this.showComponents(),this.clearInfoSelected(),this.geocoder=new google.maps.Geocoder,this.geocoder.geocode(Object.assign({address:t.value},this.regions&&{region:this.regions}),((t,e)=>{e==google.maps.GeocoderStatus.OK?this.calculateCoordinates(t[0].geometry.location):console.log("Geocode was not successful for the following reason: "+e)})),this.deleteMarkers(),this.visible=!0}calculateCoordinates(t){const e=t.lat(),s=t.lng(),a=1e3*this.distance*89e-7,i=e+a,o=s+a/Math.cos(.018*e);this.map.setCenter(new google.maps.LatLng(e,s)),this.position={lat:e,lng:s};const n=new google.maps.Circle({strokeOpacity:0,fillOpacity:0,map:this.map,center:new google.maps.LatLng(e,s),radius:1e3*this.distance});this.map.fitBounds(n.getBounds(),0),this.searchCompleted.emit({lat:e,new_lat:i,long:s,new_long:o})}showComponents(){const t=this.searchLocationsElement.querySelector("#map"),e=this.searchLocationsElement.querySelector(".info-container");t.classList.remove("hide"),e.classList.remove("hide"),this.table.classList.remove("hide")}hideComponents(){const t=this.searchLocationsElement.querySelector("#map"),e=this.searchLocationsElement.querySelector(".info-container");t.classList.add("hide"),e.classList.add("hide"),this.table.classList.add("hide")}addMarkers(){this.deleteMarkers(),this.locations.length&&this.locations.map(((t,e)=>{const s=new google.maps.LatLng(t.coordenadaX,t.coordenadaY),a=new google.maps.Marker({position:s,icon:this.url_assets+"mark_white.svg"});let i=!1;google.maps.event.addListener(a,"click",(()=>{const t=this.markers.indexOf(a),s=t>-1?t:e,o=this.locations[s];i===a?(this.infoWindow.close(),this.clearInfoSelected(),i=!1):(this.showInfoMarker(s),i=a),this.updateMarkerIcons(s),this.map.panTo(a.getPosition());const n=this.dataTable.rows(".map-item-selected");if(this.removeTablePrevItem(),n[0][0]!==s){const t=`<div class="tooltip-map"><h5 class="title">${o.razonComercial}</h5>\n            <div class='bodyContent'><p class="text">${o.tipoConciertoTaller?"Taller concertado":"Taller no concertado"}<br>${o.tipoVia} ${o.nombreVia} - ${o.poblacion} ${o.localidad}</p></div></div>`;google.maps.event.addListener(this.infoWindow,"closeclick",(()=>{google.maps.event.trigger(i,"click")})),this.infoWindow.setContent(t),this.infoWindow.open(this.map,a),this.dataTable.row(s).nodes().to$().addClass("map-item-selected").addClass("selected"),this.moveToPageWithSelectedItem()}})),this.markers.push(a)}))}createClusters(){this.map&&this.markers.length&&(this.markerCluster=new n(this.map,this.markers,{styles:[{textColor:"white",url:this.url_assets+"mark_cluster.svg",height:32,width:32,lineHeight:32}],maxZoom:12}))}setMapOnAll(t){for(var e=0;e<this.markers.length;e++)this.markers[e].setMap(t)}clearMarkers(){this.setMapOnAll(null)}showMarkers(){this.setMapOnAll(this.map)}deleteMarkers(){this.clearMarkers(),this.markerCluster&&this.markerCluster.clearMarkers(),this.markers=[]}showInfoMarker(t){this.itemSelected.emit(this.locations[t].claveTaller)}showInfoSelected(){if(this.isEmptyObj(this.infoSelected))return;const t=this.searchLocationsElement.querySelector(".info-container"),e=this.infoSelected.marcas.map((t=>`<img class="ico-marca" src="${this.url_marca}/${t.ico}" alt="${t.title}" title="${t.title}"/>`)).join("");t.classList.add("info"),t.innerHTML=`<div class="col-4 mt-s col-compacto">\n    <span><small class="grey ">Dirección: </small><small> ${this.infoSelected.direccion}</small></span>\n    <span><small class="grey ">Código: </small><small>${this.infoSelected.codTaller}</small></span>\n    <span><small class="grey ">Tipo taller: </small><small>${this.infoSelected.tipo}</small></span>\n    <span><small class="grey ">Garantía mecánica: </small><small>${this.infoSelected.estadoGm}</small></span>\n    </div>\n    <div class="col-4 mt-s col-compacto">\n    <span><small class="grey ">Horarios:</small><small>${this.infoSelected.horarios}</small></span>\n    <span><small class="grey ">Actividad: </small><small>${this.infoSelected.actividades}</small></span>\n    </div>\n    <div class="col-4 mt-s col-compacto">\n    <span><small class="grey ">Persona de contacto: </small><small>${this.infoSelected.personaContacto}</small></span>\n    <span><small class="grey ">Teléfono: </small><small>${this.infoSelected.telefono}</small></span>\n    <span class="marcas-container"><small class="grey">Marcas: </small>${e}\n    </div>`,this.searchLocationsElement.querySelectorAll(".ico-marca").forEach((t=>{t.addEventListener("error",(()=>this.imgError(t)))}))}imgError(t){return t.src=this.url_marca+"/missing.png",!0}clearInfoSelected(){this.infoSelected={};const t=this.searchLocationsElement.querySelector(".info-container");t.classList.remove("info"),t.innerHTML="Selecciona una ubicación para ver más detalles"}updateMarkerIcons(t){const e=this.markers[t].getIcon();for(var s=0;s<this.markers.length;s++)this.markers[s].setIcon(s!==t||e===this.url_assets+"mark_pink.svg"?this.url_assets+"mark_white.svg":this.url_assets+"mark_pink.svg")}moveToPageWithSelectedItem(){var t=this.dataTable.data().length,e=this.dataTable.page.len();if(e<t){var s=this.dataTable.row(".selected").node(),a=this.dataTable.rows({order:"current"}).nodes().indexOf(s),i=Math.floor(a/e);this.dataTable.page(i).draw(!1),this.searchLocationsElement.querySelector("mm-search-locations mm-pagination").setAttribute("current-page",(i+1).toString())}}isEmptyObj(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}get searchLocationsElement(){return a(this)}static get watchers(){return{locations:["validateLocations"]}}};c.style=':root{--grey_050:#fcfcfa;--grey_100:#f9f9f9;--grey_200:#f2f2f2;--grey_300:#e9ecf0;--grey_400:#dfe1e2;--grey_500:#ccc;--grey_600:#a0aab5;--grey_700:#89858e;--grey_750:#73757b;--grey_800:#61616a;--grey_900:#55494c;--grey_950:#2a2425;--brand_accent_100:#f2fafd;--brand_accent_200:#e3f2fd;--brand_accent_300:#c1e3fc;--brand_accent_500:#00a4e3;--brand_accent_750:#0068a3;--brand_accent_800:#004a93;--primary_500:#3269b3;--primary_900:#283c57;--full_white:#fff;--full_black:#000;--action_300:#e56aa8;--action_500:#c9337d;--action_800:#750e70;--action_900:#440d7f;--status_critical_100:#fcded4;--status_critical_500:#d62c42;--status_critical_800:#660837;--status_warning_100:#fff2d6;--status_warning_500:#ffae33;--status_warning_800:#66380f;--status_success_100:#e6f8e0;--status_success_500:#42804a;--status_success_800:#0c3d25;--status_info_100:#e5fafe;--status_info_500:#7cc3f4;--status_info_800:#004a93;--client_platinium:#625951;--client_gold_500:#e0af31;--client_gold_800:#66380f;--client_basic:#3269b3;--client_hogar:#ffffff;--enviroment_dev:#f118a7;--enviroment_acp:#68d568;--enviroment_prf:#7cc3f4;--enviroment_uat:#ffd400;--segmentoa_500:#7aebb7;--segmentoa_800:#006060;--segmentob_500:#9ad7ff;--segmentob_800:#3a539b;--segmentoc_500:#e38b63;--segmentoc_800:#600000;--segmentod_500:#d999f2;--segmentod_800:#561b8d;--cca_500:#f2bf2e;--cca_800:#ff6e33}mm-search-locations .mm-search-locations-container{display:flex;width:1260px;padding:20px}mm-search-locations .mm-search-locations-container .table-container{position:relative;padding-right:30px}mm-search-locations .mm-search-locations-container .table-container #selectPos{position:absolute;right:0;bottom:0}mm-search-locations .mm-search-locations-container .table-container .search-container{display:flex;align-items:flex-end}mm-search-locations .mm-search-locations-container .table-container .search-container mm-textfield{width:545px;padding-right:30px}mm-search-locations .mm-search-locations-container .table-container mm-listing table thead th.distance{width:120px}mm-search-locations .mm-search-locations-container .table-container mm-listing table thead th.concertado{width:95px}mm-search-locations .mm-search-locations-container .table-container mm-listing .page-elements-selector{display:none}mm-search-locations .mm-search-locations-container .table-container .info-container{height:193px;background-color:var(--grey_100, #f9f9f9);color:var(--grey_600, #a0aab5);display:flex;align-items:center;justify-content:center}mm-search-locations .mm-search-locations-container .table-container .info-container.info{align-items:flex-start}mm-search-locations .mm-search-locations-container .table-container .info-container .col-compacto span{display:block;width:100%;min-height:20px}mm-search-locations .mm-search-locations-container .table-container .info-container .col-compacto span small{display:initial;word-break:break-all}mm-search-locations .mm-search-locations-container .table-container .info-container .title-text-compacto{border-bottom:0px}mm-search-locations .mm-search-locations-container .table-container .info-container .marcas-container{display:flex !important;align-content:center}mm-search-locations .mm-search-locations-container .table-container .info-container .marcas-container .ico-marca{padding-left:5px;width:20px;height:20px}mm-search-locations .mm-search-locations-container .map-container #map{width:565px;height:641px}mm-search-locations .hide{height:auto;display:none !important}mm-search-locations .tooltip-map .title{font-family:"OpenSans-Bold";padding-bottom:10px}mm-search-locations .tooltip-map .text{margin:0;font-size:13px}mm-search-locations .gm-ui-hover-effect{top:0 !important;right:0 !important}mm-search-locations .gm-style-iw{border-radius:4px !important}';export{c as mm_search_locations}